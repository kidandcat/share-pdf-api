<!DOCTYPE html>
<html>

<head>
    <script src="../../../vue.js"></script>
    <script src="../../../vue-resource.min.js"></script>
    <style>
        #block {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 250px;
            height: 250px;
            transform: translate(-50%, -60%);
            background-color: #D9D8DA;
            border-radius: 10px;
            color: #747576;
            font-size: 20px;
            padding: 10px;
        }
        
        #block2 {
            position: absolute;
            top: 50%;
            left: 50%;
            height: 400px;
            transform: translate(-50%, -50%);
            background-color: #D9D8DA;
            border-radius: 10px;
            color: #747576;
            font-size: 20px;
            width: 400px;
        }
        
        a {
            display: block;
            margin: 20px;
        }
        
        span {
            display: block;
            margin: 5px;
            margin-left: 20px;
        }
        
        input {
            border: none;
            outline: none;
            border-radius: 3px;
            width: 200px;
            height: 24px;
            margin-bottom: 10px;
            margin-left: 20px;
        }
        
        button {
            display: block;
            width: 200px;
            margin: 20px;
            background: none;
            background-color: #0089f2;
            color: white;
            border: none;
            border-radius: 5px;
            height: 40px;
            margin-left: 20px;
        }
    </style>
</head>

<body>
    <div id="form">
        <template v-if="list">
            <div id="block2">
                <a href="#" v-for="file in list" onclick="form.import('{{ file.link }}')">{{ file.name }}</a>
            </div>
        </template>
        <template v-else>
            <div id="block">
                <span>User</span>
                <input type="text" v-model="user" autofocus>
                <span>Password</span>
                <input type="password" v-model="password" v-on:keyup.enter="getList">
                <button v-on:click="getList">Login</button>
            </div>
        </template>

    </div>
</body>
<script>
    var form = new Vue({
        el: '#form',
        data: {
            user: '',
            password: '',
            list: false
        },
        methods: {
            getList: function(){
                var self = this;
                 if(this.user != '' && this.password != ''){
                     Vue.http.get('/pdf/vdrive/list/' + this.user + '/' + this.password).then(function(res){
                         res.data.shift();
                         self.list = res.data;
                     }, function(err){
                         console.log(err);
                     });
                }
            },
            import: function(link){
                var ln = link.split(':path').join(window.room);
                Vue.http.get(ln).then(function(res){
                    window.opener.postMessage(JSON.stringify(res), '*');
                    window.close();
                }, function(err){
                    console.log(err);
                });
            }
        }
    });

</script>

</html>